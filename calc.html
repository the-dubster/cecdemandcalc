import React, { useState, useEffect, useCallback } from 'react';

// Constants for CEC calculations
const SQFT_TO_SQM_CONVERSION = 0.092903;
const BASE_LOAD_AREA_THRESHOLD = 90; // m²
const BASE_LOAD_INITIAL_WATTS = 5000; // W
const ADDITIONAL_LOAD_PER_AREA_INCREMENT = 1000; // W per 90m² or portion
const RANGE_BASE_LOAD_WATTS = 6000; // W
const RANGE_EXCESS_THRESHOLD_W = 12000; // Watts
const RANGE_EXCESS_PERCENTAGE = 0.40; // 40%
const OTHER_LOADS_THRESHOLD_WATTS = 1500; // W
const OTHER_LOADS_NO_RANGE_INITIAL_THRESHOLD_WATTS = 6000; // W
const OTHER_LOADS_NO_RANGE_INITIAL_PERCENTAGE = 1.00; // 100%
const OTHER_LOADS_NO_RANGE_EXCESS_PERCENTAGE = 0.25; // 25%
const OTHER_LOADS_WITH_RANGE_PERCENTAGE = 0.25; // 25%

const VOLTAGE_FOR_AMPS = 240; // Volts

// Constants for Rule 62-118
const HEATING_DEMAND_FIRST_THRESHOLD_KW = 10; // kW
const HEATING_DEMAND_FIRST_THRESHOLD_W = HEATING_DEMAND_FIRST_THRESHOLD_KW * 1000; // Watts
const HEATING_DEMAND_FIRST_PERCENTAGE = 1.00; // 100%
const HEATING_DEMAND_BALANCE_PERCENTAGE = 0.75; // 75%


// Helper component for input fields
const InputField = ({ label, type = "number", value, onChange, unit, placeholder, min = 0, step = "any", className = "" }) => (
    <div className={`mb-4 ${className}`}>
        <label className="block text-sm font-medium text-gray-300 mb-1">{label}</label>
        <div className="flex items-center">
            <input
                type={type}
                value={value}
                onChange={onChange}
                placeholder={placeholder || (type === "number" ? "0" : "")}
                min={min}
                step={step}
                className="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-white"
            />
            {unit && <span className="ml-2 text-gray-400">{unit}</span>}
        </div>
    </div>
);

// Helper component for displaying calculation steps
const CalculationStep = ({ label, value, unit = "W", details }) => (
    <div className="mb-2 p-2 bg-gray-700 rounded-md">
        <div className="flex justify-between items-center">
            <span className="text-gray-300">{label}:</span>
            <span className="font-semibold text-indigo-400">{value.toLocaleString()} {unit}</span>
        </div>
        {details && <p className="text-xs text-gray-400 mt-1">{details}</p>}
    </div>
);

function App() {
    // --- State Variables ---
    const [aboveGroundAreaInput, setAboveGroundAreaInput] = useState('');
    const [belowGroundAreaInput, setBelowGroundAreaInput] = useState('');
    const [areaUnit, setAreaUnit] = useState('sqft'); // Default to square feet
    const [totalEffectiveLivingAreaM2, setTotalEffectiveLivingAreaM2] = useState(0);

    // Space Heating States (Rule 62-118)
    const [totalConnectedSpaceHeatingW, setTotalConnectedSpaceHeatingW] = useState(''); // User input for total connected heating
    const [applyRule62_118_3, setApplyRule62_118_3] = useState(false); // Checkbox for Rule 62-118 3)
    const [applyRule62_118_4, setApplyRule62_118_4] = useState(false); // Checkbox for Rule 62-118 4)
    const [calculatedHeatingDemandW, setCalculatedHeatingDemandW] = useState(0); // Heating load after demand factors

    const [airConditioningLoad, setAirConditioningLoad] = useState('');

    const [hasElectricRange, setHasElectricRange] = useState(true); // Default to true
    const [electricRangeRatingW, setElectricRangeRatingW] = useState('6000'); // Default to 6000W

    const [tanklessWaterHeaterLoad, setTanklessWaterHeaterLoad] = useState('');
    const [evSupplyEquipmentLoad, setEvSupplyEquipmentLoad] = useState('');

    const [otherLoads, setOtherLoads] = useState([{ id: Date.now(), name: '', value: '' }]);

    const [calculatedLoadA, setCalculatedLoadA] = useState(0);
    const [calculationStepsA, setCalculationStepsA] = useState([]);
    const [finalCalculatedLoad, setFinalCalculatedLoad] = useState(0); 


    // --- Input Handlers ---
    const handleAboveGroundAreaInputChange = (e) => setAboveGroundAreaInput(e.target.value);
    const handleBelowGroundAreaInputChange = (e) => setBelowGroundAreaInput(e.target.value);
    const handleAreaUnitChange = (e) => setAreaUnit(e.target.value);
    
    const handleOtherLoadChange = (id, fieldName, newValue) => {
        setOtherLoads(prevLoads =>
            prevLoads.map(load => 
                load.id === id ? { ...load, [fieldName]: newValue } : load
            )
        );
    };
    const addOtherLoad = () => setOtherLoads(prevLoads => [...prevLoads, { id: Date.now(), name: '', value: '' }]);
    const removeOtherLoad = (id) => setOtherLoads(prevLoads => prevLoads.filter(load => load.id !== id));

    // --- Calculation Logic ---
    const calculateLoad = useCallback(() => {
        const stepsA = [];

        // Living Area Calculation
        let inputAboveM2 = parseFloat(aboveGroundAreaInput) || 0;
        let inputBelowM2 = parseFloat(belowGroundAreaInput) || 0;
        if (areaUnit === 'sqft') {
            inputAboveM2 *= SQFT_TO_SQM_CONVERSION;
            inputBelowM2 *= SQFT_TO_SQM_CONVERSION;
        }
        const effectiveAboveGroundM2 = inputAboveM2;
        const effectiveBelowGroundM2 = inputBelowM2 * 0.75;
        const currentTotalEffectiveLivingAreaM2 = effectiveAboveGroundM2 + effectiveBelowGroundM2;
        setTotalEffectiveLivingAreaM2(currentTotalEffectiveLivingAreaM2);
        
        // Rule 8-200 1) a) Calculation
        let totalLoadA = 0;
        let basicLoadLivingArea = 0;
        let basicLoadDetails = "";
        if (currentTotalEffectiveLivingAreaM2 > 0) {
            basicLoadLivingArea = BASE_LOAD_INITIAL_WATTS;
            basicLoadDetails = `${BASE_LOAD_INITIAL_WATTS}W for first ${Math.min(currentTotalEffectiveLivingAreaM2, BASE_LOAD_AREA_THRESHOLD).toFixed(2)} m² of effective living area.`;
            if (currentTotalEffectiveLivingAreaM2 > BASE_LOAD_AREA_THRESHOLD) {
                const excessArea = currentTotalEffectiveLivingAreaM2 - BASE_LOAD_AREA_THRESHOLD;
                const additionalPortions = Math.ceil(excessArea / BASE_LOAD_AREA_THRESHOLD);
                const additionalLoad = additionalPortions * ADDITIONAL_LOAD_PER_AREA_INCREMENT;
                basicLoadLivingArea += additionalLoad;
                basicLoadDetails += ` + ${additionalLoad}W for ${excessArea.toFixed(2)} m² excess (${additionalPortions} portion(s) of ${BASE_LOAD_AREA_THRESHOLD} m²).`;
            }
        }
        stepsA.push({ label: "i) & ii) Basic Living Area Load", value: basicLoadLivingArea, details: basicLoadDetails || `Effective Living Area: ${currentTotalEffectiveLivingAreaM2.toFixed(2)} m²` });
        totalLoadA += basicLoadLivingArea;

        // Electric Space Heating Calculation (Rule 62-118)
        const connectedHeatingW = parseFloat(totalConnectedSpaceHeatingW) || 0;
        let currentCalculatedHeatingDemandW = 0;
        let heatingDemandDetails = "No connected heating load or specific rule applied.";

        if (connectedHeatingW > 0) {
            if (applyRule62_118_4) {
                currentCalculatedHeatingDemandW = connectedHeatingW; // 100% demand
                heatingDemandDetails = `Rule 62-118 4) applied (Special System): 100% of ${connectedHeatingW.toLocaleString()}W.`;
            } else if (applyRule62_118_3) {
                if (connectedHeatingW <= HEATING_DEMAND_FIRST_THRESHOLD_W) {
                    currentCalculatedHeatingDemandW = connectedHeatingW * HEATING_DEMAND_FIRST_PERCENTAGE;
                    heatingDemandDetails = `Rule 62-118 3) applied: First 10kW (or less) at 100%. Connected: ${connectedHeatingW.toLocaleString()}W.`;
                } else {
                    const firstPart = HEATING_DEMAND_FIRST_THRESHOLD_W * HEATING_DEMAND_FIRST_PERCENTAGE;
                    const balancePart = (connectedHeatingW - HEATING_DEMAND_FIRST_THRESHOLD_W) * HEATING_DEMAND_BALANCE_PERCENTAGE;
                    currentCalculatedHeatingDemandW = firstPart + balancePart;
                    heatingDemandDetails = `Rule 62-118 3) applied: ${HEATING_DEMAND_FIRST_THRESHOLD_W.toLocaleString()}W at 100% + ${(connectedHeatingW - HEATING_DEMAND_FIRST_THRESHOLD_W).toLocaleString()}W at 75%. Connected: ${connectedHeatingW.toLocaleString()}W.`;
                }
            } else {
                // Default to 100% if no specific rule is selected by the user, or if it's non-residential / no individual thermostats
                currentCalculatedHeatingDemandW = connectedHeatingW;
                heatingDemandDetails = `100% of connected heating load (${connectedHeatingW.toLocaleString()}W) applied (no specific residential demand rule selected or applicable).`;
            }
        }
        setCalculatedHeatingDemandW(currentCalculatedHeatingDemandW); // Update state for UI display if needed elsewhere
        totalLoadA += currentCalculatedHeatingDemandW;
        stepsA.push({ label: "iii) Electric Space Heating", value: currentCalculatedHeatingDemandW, details: heatingDemandDetails });
        
        // Air Conditioning
        const ac = parseFloat(airConditioningLoad) || 0;
        totalLoadA += ac;
        stepsA.push({ label: "iii) Air Conditioning (100%)", value: ac });

        // Electric Range
        let rangeLoad = 0;
        let rangeDetails = "No electric range provided.";
        if (hasElectricRange) {
            const rangeRatingWVal = parseFloat(electricRangeRatingW) || 0;
            rangeLoad = RANGE_BASE_LOAD_WATTS; 
            rangeDetails = `${RANGE_BASE_LOAD_WATTS}W for single range`;
            if (rangeRatingWVal > RANGE_EXCESS_THRESHOLD_W) {
                const excessW = rangeRatingWVal - RANGE_EXCESS_THRESHOLD_W;
                const additionalRangeLoad = excessW * RANGE_EXCESS_PERCENTAGE;
                rangeLoad += additionalRangeLoad; 
                rangeDetails += ` + ${additionalRangeLoad.toFixed(0)}W (40% of ${excessW.toFixed(0)}W excess over ${RANGE_EXCESS_THRESHOLD_W}W)`;
            }
        }
        totalLoadA += rangeLoad;
        stepsA.push({ label: "iv) Electric Range Load", value: rangeLoad, details: rangeDetails });

        // Other Major Loads
        const tanklessLoad = parseFloat(tanklessWaterHeaterLoad) || 0;
        totalLoadA += tanklessLoad;
        stepsA.push({ label: "v) Tankless Water Heaters / Pool / Spa (100%)", value: tanklessLoad });

        const evLoad = parseFloat(evSupplyEquipmentLoad) || 0;
        totalLoadA += evLoad;
        stepsA.push({ label: "vi) EV Supply Equipment (100%)", value: evLoad });

        // Other Loads > 1500W
        let otherLoadsTotalWatts = 0;
        let otherLoadsCalculationDetails = "";
        const validOtherLoadsValues = otherLoads
            .map(l => parseFloat(l.value) || 0)
            .filter(val => val > OTHER_LOADS_THRESHOLD_WATTS);

        if (validOtherLoadsValues.length > 0) {
            if (hasElectricRange) {
                validOtherLoadsValues.forEach(loadValue => { 
                    otherLoadsTotalWatts += loadValue * OTHER_LOADS_WITH_RANGE_PERCENTAGE; 
                });
                otherLoadsCalculationDetails = `Electric range provided. Calculated at 25% of each load > ${OTHER_LOADS_THRESHOLD_WATTS}W. Wattages considered: ${validOtherLoadsValues.join('W, ')}W.`;
            } else {
                const combinedOtherLoad = validOtherLoadsValues.reduce((sum, val) => sum + val, 0);
                if (combinedOtherLoad <= OTHER_LOADS_NO_RANGE_INITIAL_THRESHOLD_WATTS) {
                    otherLoadsTotalWatts = combinedOtherLoad * OTHER_LOADS_NO_RANGE_INITIAL_PERCENTAGE;
                    otherLoadsCalculationDetails = `No electric range. Combined other loads (${combinedOtherLoad}W) <= ${OTHER_LOADS_NO_RANGE_INITIAL_THRESHOLD_WATTS}W. Calculated at 100%.`;
                } else {
                    otherLoadsTotalWatts = (OTHER_LOADS_NO_RANGE_INITIAL_THRESHOLD_WATTS * OTHER_LOADS_NO_RANGE_INITIAL_PERCENTAGE) +
                                       ((combinedOtherLoad - OTHER_LOADS_NO_RANGE_INITIAL_THRESHOLD_WATTS) * OTHER_LOADS_NO_RANGE_EXCESS_PERCENTAGE);
                    otherLoadsCalculationDetails = `No electric range. Combined other loads (${combinedOtherLoad}W) > ${OTHER_LOADS_NO_RANGE_INITIAL_THRESHOLD_WATTS}W. ${OTHER_LOADS_NO_RANGE_INITIAL_THRESHOLD_WATTS}W at 100% + ${(combinedOtherLoad - OTHER_LOADS_NO_RANGE_INITIAL_THRESHOLD_WATTS).toFixed(0)}W at 25%.`;
                }
            }
        } else {
            otherLoadsCalculationDetails = `No other loads > ${OTHER_LOADS_THRESHOLD_WATTS}W provided or applicable.`;
        }
        totalLoadA += otherLoadsTotalWatts;
        stepsA.push({ label: `vii) Other Loads > ${OTHER_LOADS_THRESHOLD_WATTS}W`, value: otherLoadsTotalWatts, details: otherLoadsCalculationDetails });
        
        setCalculatedLoadA(totalLoadA);
        setCalculationStepsA(stepsA);
        setFinalCalculatedLoad(totalLoadA);

    }, [
        aboveGroundAreaInput, belowGroundAreaInput, areaUnit,
        totalConnectedSpaceHeatingW, applyRule62_118_3, applyRule62_118_4, // New heating states
        airConditioningLoad,
        hasElectricRange, electricRangeRatingW,
        tanklessWaterHeaterLoad, evSupplyEquipmentLoad,
        otherLoads,
    ]);

    useEffect(() => {
        calculateLoad();
    }, [calculateLoad]);

    // Effect to update calculatedHeatingDemandW for display purposes when inputs change
    useEffect(() => {
        const connectedHeatingW = parseFloat(totalConnectedSpaceHeatingW) || 0;
        let currentCalculatedHeatingDemandW = 0;
        if (connectedHeatingW > 0) {
            if (applyRule62_118_4) {
                currentCalculatedHeatingDemandW = connectedHeatingW;
            } else if (applyRule62_118_3) {
                if (connectedHeatingW <= HEATING_DEMAND_FIRST_THRESHOLD_W) {
                    currentCalculatedHeatingDemandW = connectedHeatingW * HEATING_DEMAND_FIRST_PERCENTAGE;
                } else {
                    const firstPart = HEATING_DEMAND_FIRST_THRESHOLD_W * HEATING_DEMAND_FIRST_PERCENTAGE;
                    const balancePart = (connectedHeatingW - HEATING_DEMAND_FIRST_THRESHOLD_W) * HEATING_DEMAND_BALANCE_PERCENTAGE;
                    currentCalculatedHeatingDemandW = firstPart + balancePart;
                }
            } else {
                currentCalculatedHeatingDemandW = connectedHeatingW;
            }
        }
        setCalculatedHeatingDemandW(currentCalculatedHeatingDemandW);
    }, [totalConnectedSpaceHeatingW, applyRule62_118_3, applyRule62_118_4]);


    return (
        <div className="min-h-screen bg-gray-900 text-white p-4 sm:p-8 font-sans">
            <div className="max-w-4xl mx-auto">
                <header className="mb-8 text-center">
                    <h1 className="text-3xl sm:text-4xl font-bold text-indigo-400">CEC 2024 Load Calculator</h1>
                    <p className="text-lg text-gray-400">Single Dwelling (Rule 8-200 1)a) Only)</p>
                     <p className="text-xs text-gray-500 mt-2">
                        Note: This calculator is for estimation purposes only based on CEC 2024 Rule 8-200 1)a), 8-110 & 62-118.
                        Rule 8-200 1)b) is not included in this version.
                        Always consult the official Canadian Electrical Code and a qualified professional for accurate calculations and installations.
                    </p>
                </header>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                    {/* --- Input Section --- */}
                    <div className="bg-gray-800 p-6 rounded-lg shadow-xl">
                        <h2 className="text-2xl font-semibold mb-6 text-indigo-300 border-b border-gray-700 pb-2">Input Values</h2>

                        <fieldset className="mb-6 border border-gray-700 p-4 rounded-md">
                            <legend className="text-lg font-medium text-indigo-400 px-2">1. Living Area (Rule 8-110)</legend>
                            <p className="text-xs text-gray-400 mb-1">a) 100% of area on ground floor & areas above ground floor used for living.</p>
                            <InputField label="Above-Ground Living Area" value={aboveGroundAreaInput} onChange={handleAboveGroundAreaInputChange} placeholder="e.g., 1076" />
                            <p className="text-xs text-gray-400 mb-1 mt-3">c) 75% of areas below ground {'>'}1.8m height.</p>
                            <InputField label="Below-Ground Living Area (Portion >1.8m height)" value={belowGroundAreaInput} onChange={handleBelowGroundAreaInputChange} placeholder="e.g., 538" />
                            <div className="flex items-center mt-2">
                                <label className="text-sm font-medium text-gray-300 mr-2">Unit for areas:</label>
                                <select value={areaUnit} onChange={handleAreaUnitChange} className="h-10 block px-3 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-white">
                                    <option value="sqft">ft²</option>
                                    <option value="sqm">m²</option>
                                </select>
                            </div>
                            {totalEffectiveLivingAreaM2 > 0 && <p className="text-xs text-gray-400 mt-2 p-2 bg-gray-750 rounded-md">Total Effective Living Area: {totalEffectiveLivingAreaM2.toFixed(2)} m²</p>}
                        </fieldset>
                        
                        <fieldset className="mb-6 border border-gray-700 p-4 rounded-md">
                            <legend className="text-lg font-medium text-indigo-400 px-2">2. Electric Space Heating & Cooling</legend>
                            <InputField 
                                label="Total Connected Electric Space Heating Load (W)" 
                                value={totalConnectedSpaceHeatingW} 
                                onChange={(e) => setTotalConnectedSpaceHeatingW(e.target.value)} 
                                unit="W" 
                                placeholder="e.g., 15000" 
                            />
                            <div className="mb-3 mt-1 space-y-2">
                                <div className="flex items-center">
                                    <input 
                                        type="checkbox" 
                                        id="applyRule62_118_3" 
                                        checked={applyRule62_118_3} 
                                        onChange={(e) => setApplyRule62_118_3(e.target.checked)}
                                        disabled={applyRule62_118_4} // Disable if Rule 4 is checked
                                        className="h-4 w-4 text-indigo-600 border-gray-600 bg-gray-700 rounded focus:ring-indigo-500"
                                    />
                                    <label htmlFor="applyRule62_118_3" className="ml-2 text-sm text-gray-300">
                                        Residential w/ individual thermostatic controls (Rule 62-118 3))?
                                    </label>
                                </div>
                                <div className="flex items-center">
                                    <input 
                                        type="checkbox" 
                                        id="applyRule62_118_4" 
                                        checked={applyRule62_118_4} 
                                        onChange={(e) => setApplyRule62_118_4(e.target.checked)}
                                        className="h-4 w-4 text-indigo-600 border-gray-600 bg-gray-700 rounded focus:ring-indigo-500"
                                    />
                                    <label htmlFor="applyRule62_118_4" className="ml-2 text-sm text-gray-300">
                                        System is electric thermal storage, duct heater, or furnace (Rule 62-118 4))?
                                    </label>
                                </div>
                            </div>
                             {parseFloat(totalConnectedSpaceHeatingW) > 0 && (
                                <p className="text-sm text-gray-400 mt-1 p-2 bg-gray-750 rounded-md">
                                    Calculated Heating Load (after demand): <span className="font-semibold text-indigo-300">{calculatedHeatingDemandW.toLocaleString()} W</span>
                                </p>
                            )}

                            <InputField 
                                label="Air Conditioning Load (W)" 
                                value={airConditioningLoad} 
                                onChange={(e) => setAirConditioningLoad(e.target.value)} 
                                unit="W" 
                                placeholder="100% of AC load" 
                                className="mt-6" // Add margin top for separation
                            />
                        </fieldset>

                        <fieldset className="mb-6 border border-gray-700 p-4 rounded-md">
                            <legend className="text-lg font-medium text-indigo-400 px-2">3. Electric Range</legend>
                            <div className="flex items-center mb-3">
                                <input type="checkbox" id="hasElectricRange" checked={hasElectricRange} onChange={(e) => setHasElectricRange(e.target.checked)} className="h-4 w-4 text-indigo-600 border-gray-600 bg-gray-700 rounded focus:ring-indigo-500" />
                                <label htmlFor="hasElectricRange" className="ml-2 text-sm text-gray-300">Electric Range Provided?</label>
                            </div>
                            {hasElectricRange && <InputField label="Electric Range Rating (W)" value={electricRangeRatingW} onChange={(e) => setElectricRangeRatingW(e.target.value)} unit="W" placeholder="e.g., 13000" />}
                        </fieldset>

                        <fieldset className="mb-6 border border-gray-700 p-4 rounded-md">
                            <legend className="text-lg font-medium text-indigo-400 px-2">4. Other Major Loads (100% Demand)</legend>
                            <InputField label="Tankless Water Heaters / Pool / Spa (W)" value={tanklessWaterHeaterLoad} onChange={(e) => setTanklessWaterHeaterLoad(e.target.value)} unit="W" />
                            <InputField label="EV Supply Equipment (EVSE) (W)" value={evSupplyEquipmentLoad} onChange={(e) => setEvSupplyEquipmentLoad(e.target.value)} unit="W" />
                        </fieldset>

                        <fieldset className="mb-6 border border-gray-700 p-4 rounded-md">
                            <legend className="text-lg font-medium text-indigo-400 px-2">5. Other Loads (each {'>'} 1500W)</legend>
                            <p className="text-xs text-gray-400 mb-3">Individual loads {'>'}1500W not covered above.</p>
                            {otherLoads.map((load, index) => (
                                <div key={load.id} className="grid grid-cols-1 sm:grid-cols-3 gap-x-2 items-end mb-2">
                                    <InputField
                                        label={`Load ${index + 1} Name`}
                                        type="text"
                                        value={load.name}
                                        onChange={(e) => handleOtherLoadChange(load.id, 'name', e.target.value)}
                                        placeholder="e.g., Clothes Dryer, Welder"
                                        className="sm:col-span-2"
                                    />
                                    <InputField
                                        label={`Value (W)`}
                                        value={load.value}
                                        onChange={(e) => handleOtherLoadChange(load.id, 'value', e.target.value)}
                                        unit="W"
                                        placeholder="e.g., 5000"
                                        className="sm:col-span-1"
                                    />
                                    {otherLoads.length > 0 && ( 
                                        <button
                                            onClick={() => removeOtherLoad(load.id)}
                                            className="ml-auto sm:ml-0 p-2 bg-red-600 hover:bg-red-700 text-white rounded-md text-xs h-10 mt-1 sm:mt-7" 
                                        >
                                            Remove
                                        </button>
                                    )}
                                </div>
                            ))}
                            <button onClick={addOtherLoad} className="mt-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md text-sm">Add Another Load</button>
                        </fieldset>
                    </div>

                    {/* --- Results Section --- */}
                    <div className="bg-gray-800 p-6 rounded-lg shadow-xl">
                        <h2 className="text-2xl font-semibold mb-6 text-indigo-300 border-b border-gray-700 pb-2">Calculation Results</h2>
                        
                        <div className="mb-6">
                            <h3 className="text-xl font-semibold mb-3 text-indigo-400">Rule 8-200 1) a) Calculation Details:</h3>
                            {calculationStepsA.map((step, index) => <CalculationStep key={`a-${index}`} label={step.label} value={step.value} details={step.details} />)}
                            <div className="mt-4 p-3 bg-gray-700 rounded-md shadow">
                                <div className="flex justify-between items-center">
                                    <span className="text-lg font-semibold text-gray-200">Total for Rule 1) a):</span>
                                    <span className="text-xl font-bold text-green-400">{calculatedLoadA.toLocaleString()} W</span>
                                </div>
                            </div>
                        </div>
                        
                        <div className="mt-8 p-6 bg-indigo-600 rounded-lg shadow-2xl mb-8">
                            <h3 className="text-2xl font-bold mb-2 text-white text-center">Final Calculated Load</h3>
                            <p className="text-sm text-indigo-200 mb-4 text-center">(Based on Rule 8-200 1)a) Only)</p>
                            <p className="text-4xl font-extrabold text-yellow-300 text-center">{finalCalculatedLoad.toLocaleString()} W</p>
                            <p className="text-2xl font-bold text-yellow-200 text-center mt-1">({(finalCalculatedLoad / 1000).toFixed(2)} kW)</p>
                            <p className="text-xl font-bold text-yellow-100 text-center mt-1">({(finalCalculatedLoad / VOLTAGE_FOR_AMPS).toFixed(2)} A @ {VOLTAGE_FOR_AMPS}V)</p>
                        </div>
                    </div>
                </div>
                 <footer className="mt-12 text-center text-sm text-gray-500">
                    <p>&copy; {new Date().getFullYear()} CEC Load Calculator. For estimation purposes only.</p>
                    <p>Refer to the official Canadian Electrical Code 2024 and qualified professionals.</p>
                </footer>
            </div>
        </div>
    );
}

export default App;
